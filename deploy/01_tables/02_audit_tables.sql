-- Audit and Logging Tables
-- Generated from database

-- Table: ETL_ERROR_LOG
DROP TABLE ETL_ERROR_LOG CASCADE CONSTRAINTS PURGE;
/

  CREATE TABLE "TR2000_STAGING"."ETL_ERROR_LOG"
   (	"ERROR_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE,
	"ENDPOINT_KEY" VARCHAR2(100),
	"PLANT_ID" VARCHAR2(50),
	"ISSUE_REVISION" VARCHAR2(50),
	"ERROR_TIMESTAMP" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE,
	"ERROR_TYPE" VARCHAR2(50),
	"ERROR_CODE" VARCHAR2(50),
	"ERROR_MESSAGE" VARCHAR2(4000),
	"ERROR_STACK" CLOB,
	"RAW_DATA" CLOB,
	"RESOLUTION_STATUS" VARCHAR2(50),
	"RESOLVED_BY" VARCHAR2(50),
	"RESOLUTION_NOTES" VARCHAR2(4000),
	 PRIMARY KEY ("ERROR_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"
 LOB ("ERROR_STACK") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW 4000 CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES
  STORAGE(INITIAL 262144 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT))
 LOB ("RAW_DATA") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW 4000 CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES
  STORAGE(INITIAL 262144 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT))
/

-- Table: ETL_RUN_LOG
DROP TABLE ETL_RUN_LOG CASCADE CONSTRAINTS PURGE;
/

  CREATE TABLE "TR2000_STAGING"."ETL_RUN_LOG"
   (	"RUN_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE,
	"RUN_TYPE" VARCHAR2(50) NOT NULL ENABLE,
	"START_TIME" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE,
	"END_TIME" TIMESTAMP (6),
	"STATUS" VARCHAR2(50) DEFAULT 'RUNNING' NOT NULL ENABLE,
	"INITIATED_BY" VARCHAR2(50),
	 PRIMARY KEY ("RUN_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"
/

-- Table: ETL_STATISTICS
DROP TABLE ETL_STATISTICS CASCADE CONSTRAINTS PURGE;
/

  CREATE TABLE "TR2000_STAGING"."ETL_STATISTICS"
   (	"STAT_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE,
	"RUN_ID" NUMBER,
	"STAT_TYPE" VARCHAR2(50) NOT NULL ENABLE,
	"ENDPOINT_KEY" VARCHAR2(100),
	"OPERATION_NAME" VARCHAR2(100),
	"PLANT_ID" VARCHAR2(50),
	"ISSUE_REVISION" VARCHAR2(50),
	"PCS_NAME" VARCHAR2(100),
	"START_TIME" TIMESTAMP (6) NOT NULL ENABLE,
	"END_TIME" TIMESTAMP (6),
	"DURATION_MS" NUMBER GENERATED ALWAYS AS (CASE  WHEN "END_TIME" IS NOT NULL THEN EXTRACT(DAY FROM ("END_TIME"-"START_TIME")DAY(9) TO SECOND(6))*86400000+EXTRACT(HOUR FROM ("END_TIME"-"START_TIME")DAY(9) TO SECOND(6))*3600000+EXTRACT(MINUTE FROM ("END_TIME"-"START_TIME")DAY(9) TO SECOND(6))*60000+EXTRACT(SECOND FROM ("END_TIME"-"START_TIME")DAY(9) TO SECOND(6))*1000 ELSE NULL END) VIRTUAL ,
	"RECORDS_PROCESSED" NUMBER DEFAULT 0,
	"RECORDS_INSERTED" NUMBER DEFAULT 0,
	"RECORDS_UPDATED" NUMBER DEFAULT 0,
	"RECORDS_DELETED" NUMBER DEFAULT 0,
	"RECORDS_FAILED" NUMBER DEFAULT 0,
	"API_RESPONSE_SIZE" NUMBER,
	"API_STATUS_CODE" NUMBER,
	"STATUS" VARCHAR2(50) DEFAULT 'RUNNING',
	"ERROR_MESSAGE" VARCHAR2(4000),
	"CREATED_DATE" DATE DEFAULT SYSDATE,
	"CREATED_BY" VARCHAR2(50) DEFAULT USER,
	 PRIMARY KEY ("STAT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"
/

-- Table: RAW_JSON
DROP TABLE RAW_JSON CASCADE CONSTRAINTS PURGE;
/

  CREATE TABLE "TR2000_STAGING"."RAW_JSON"
   (	"RAW_JSON_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE,
	"ENDPOINT_KEY" VARCHAR2(100),
	"ENDPOINT_TEMPLATE" VARCHAR2(500),
	"ENDPOINT_VALUE" VARCHAR2(500) NOT NULL ENABLE,
	"PAYLOAD" CLOB,
	"BATCH_ID" VARCHAR2(36),
	"API_CALL_TIMESTAMP" TIMESTAMP (6) DEFAULT SYSTIMESTAMP,
	"CREATED_DATE" DATE DEFAULT SYSDATE NOT NULL ENABLE,
	"KEY_FINGERPRINT" VARCHAR2(64),
	 PRIMARY KEY ("RAW_JSON_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION IMMEDIATE
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"
 LOB ("PAYLOAD") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW 4000 CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES
  STORAGE(INITIAL 262144 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT))
/

